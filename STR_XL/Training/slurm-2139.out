2023-05-07 20:22:32.652959: I tensorflow/core/platform/cpu_feature_guard.cc:193] This TensorFlow binary is optimized with oneAPI Deep Neural Network Library (oneDNN) to use the following CPU instructions in performance-critical operations:  SSE4.1 SSE4.2 AVX AVX2 AVX512F AVX512_VNNI FMA
To enable them in other operations, rebuild TensorFlow with the appropriate compiler flags.
2023-05-07 20:22:33.009403: I tensorflow/core/util/util.cc:169] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
wandb: wandb version 0.15.2 is available!  To upgrade, please run:
wandb:  $ pip install wandb --upgrade
wandb: Tracking run with wandb version 0.14.0
wandb: Run data is saved locally in /home/klg6z/work/TransformerXL/STR_XL/Training/wandb/run-20230507_202237-sbynfxtc
wandb: Run `wandb offline` to turn off syncing.
wandb: Syncing run confused-sound-58
wandb: ⭐️ View project at https://wandb.ai/kendragivens/StrXL_Compressed
wandb: 🚀 View run at https://wandb.ai/kendragivens/StrXL_Compressed/runs/sbynfxtc
2023-05-07 20:22:47.604856: I tensorflow/core/platform/cpu_feature_guard.cc:193] This TensorFlow binary is optimized with oneAPI Deep Neural Network Library (oneDNN) to use the following CPU instructions in performance-critical operations:  SSE4.1 SSE4.2 AVX AVX2 AVX512F AVX512_VNNI FMA
To enable them in other operations, rebuild TensorFlow with the appropriate compiler flags.
2023-05-07 20:22:49.730660: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1616] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 9632 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 2080 Ti, pci bus id: 0000:68:00.0, compute capability: 7.5
wandb: Downloading large artifact nachusa-dna:latest, 4079.09MB. 420 files... 
wandb: \ 1 of 420 files downloaded...wandb: | 46 of 420 files downloaded...wandb: / 65 of 420 files downloaded...wandb: - 101 of 420 files downloaded...wandb: \ 124 of 420 files downloaded...wandb: | 131 of 420 files downloaded...wandb: / 133 of 420 files downloaded...wandb: - 162 of 420 files downloaded...wandb: \ 173 of 420 files downloaded...wandb: | 178 of 420 files downloaded...wandb: / 185 of 420 files downloaded...wandb: - 196 of 420 files downloaded...wandb: \ 219 of 420 files downloaded...wandb: | 229 of 420 files downloaded...wandb: / 247 of 420 files downloaded...wandb: - 260 of 420 files downloaded...wandb: \ 286 of 420 files downloaded...wandb: | 301 of 420 files downloaded...wandb: / 326 of 420 files downloaded...wandb: - 347 of 420 files downloaded...wandb: \ 385 of 420 files downloaded...wandb: | 397 of 420 files downloaded...wandb: / 411 of 420 files downloaded...wandb:   420 of 420 files downloaded.  
Done. 0:0:4.0
wandb:   5 of 5 files downloaded.  
2023-05-07 20:23:06.047195: W tensorflow/core/grappler/optimizers/data/auto_shard.cc:776] AUTO sharding policy will apply DATA sharding policy as it failed to apply FILE sharding policy because of the following reason: Did not find a shardable source, walked to a node which is not a dataset: name: "FlatMapDataset/_2"
op: "FlatMapDataset"
input: "TensorDataset/_1"
attr {
  key: "Targuments"
  value {
    list {
    }
  }
}
attr {
  key: "_cardinality"
  value {
    i: -2
  }
}
attr {
  key: "f"
  value {
    func {
      name: "__inference_Dataset_flat_map_flat_map_fn_70378"
    }
  }
}
attr {
  key: "metadata"
  value {
    s: "\n\020FlatMapDataset:1"
  }
}
attr {
  key: "output_shapes"
  value {
    list {
      shape {
        dim {
          size: -1
        }
        dim {
          size: -1
        }
        dim {
          size: -1
        }
      }
      shape {
        dim {
          size: -1
        }
      }
    }
  }
}
attr {
  key: "output_types"
  value {
    list {
      type: DT_FLOAT
      type: DT_INT32
    }
  }
}
experimental_type {
  type_id: TFT_PRODUCT
  args {
    type_id: TFT_DATASET
    args {
      type_id: TFT_PRODUCT
      args {
        type_id: TFT_TENSOR
        args {
          type_id: TFT_FLOAT
        }
      }
      args {
        type_id: TFT_TENSOR
        args {
          type_id: TFT_INT32
        }
      }
    }
  }
}
. Consider either turning off auto-sharding or switching the auto_shard_policy to DATA to shard this dataset. You can do this by creating a new `tf.data.Options()` object then setting `options.experimental_distribute.auto_shard_policy = AutoShardPolicy.DATA` before applying the options object to the dataset via `dataset.with_options(options)`.
['StrXL_Compressed_Training.py', '--dataset-artifact', 'sirdavidludwig/nachusa-dna/nachusa-dna:latest', '--encoder-artifact', 'sirdavidludwig/dnabert-pretrain/dnabert-pretrain-64dim:latest', '--wandb-project', 'StrXL_Compressed', '--save-to', 'StrXL_Compressed_{seed}_{mem_len}_{num_compressed_seeds}', '--mem_len', '250', '--compressed_len', '250', '--num_compressed_seeds', '50', '--num_induce', '0', '--gpus', '0', '--seed', '0', '--epochs', '750'] Namespace(gpus=[0], dataset_path=None, dataset_artifact='sirdavidludwig/nachusa-dna/nachusa-dna:latest', encoder_path=None, encoder_artifact='sirdavidludwig/dnabert-pretrain/dnabert-pretrain-64dim:latest', seed=0, mem_switched=False, num_compressed_seeds=50, compressed_len=250, block_size=250, max_set_len=1000, num_induce=0, embed_dim=64, num_layers=8, num_heads=8, mem_len=250, compressed_mem_len=250, dropout_rate=0.01, num_seeds=1, use_layernorm=True, pre_layernorm=True, use_keras_mha=True, set_len=1000, batches_per_epoch=20, validation_batch_size=5, save_to='StrXL_Compressed_{seed}_{mem_len}_{num_compressed_seeds}', batch_size=20, sub_batch_size=0, data_workers=1, run_eagerly=False, use_dynamic_memory=False, wandb_project='StrXL_Compressed', wandb_name=None, wandb_group=None, wandb_mode='online', resume=None, initial_epoch=0, epochs=750)
Using GPU Strategy. Selected GPUs: [0]
Sample './artifacts/nachusa-dna:v0/Wes7-PCRblank1_S8_L001_R1_001.db' does not contain enough sequences. This sample will be ignored.
Sample './artifacts/nachusa-dna:v0/Wes24-PCRblank2_S25_L001_R1_001.db' does not contain enough sequences. This sample will be ignored.
Sample './artifacts/nachusa-dna:v0/Wes44-PCRblank3_S45_L001_R1_001.db' does not contain enough sequences. This sample will be ignored.
Sample './artifacts/nachusa-dna:v0/Wes7-PCRblank1_S8_L001_R1_001.db' does not contain enough sequences. This sample will be ignored.
Sample './artifacts/nachusa-dna:v0/Wesley056-NegCtrl_S195_L001_R1_001.db' does not contain enough sequences. This sample will be ignored.
Sample './artifacts/nachusa-dna:v0/Wes24-PCRblank2_S25_L001_R1_001.db' does not contain enough sequences. This sample will be ignored.
Sample './artifacts/nachusa-dna:v0/Wesley049-SB-100420_S188_L001_R1_001.db' does not contain enough sequences. This sample will be ignored.
Epoch 1/750
 1/20 [>.............................] - ETA: 20:00 - loss: 5.6893 - sparse_categorical_accuracy: 0.0000e+00 2/20 [==>...........................] - ETA: 1:54 - loss: 5.5939 - sparse_categorical_accuracy: 0.0250      3/20 [===>..........................] - ETA: 1:47 - loss: 5.5984 - sparse_categorical_accuracy: 0.0167 4/20 [=====>........................] - ETA: 1:41 - loss: 5.5875 - sparse_categorical_accuracy: 0.0125 5/20 [======>.......................] - ETA: 1:35 - loss: 5.6382 - sparse_categorical_accuracy: 0.0100 6/20 [========>.....................] - ETA: 1:29 - loss: 5.6712 - sparse_categorical_accuracy: 0.0083 7/20 [=========>....................] - ETA: 1:22 - loss: 5.6761 - sparse_categorical_accuracy: 0.0071 8/20 [===========>..................] - ETA: 1:16 - loss: 5.6484 - sparse_categorical_accuracy: 0.0063 9/20 [============>.................] - ETA: 1:09 - loss: 5.6105 - sparse_categorical_accuracy: 0.005610/20 [==============>...............] - ETA: 1:03 - loss: 5.5903 - sparse_categorical_accuracy: 0.005011/20 [===============>..............] - ETA: 57s - loss: 5.5940 - sparse_categorical_accuracy: 0.0045 12/20 [=================>............] - ETA: 50s - loss: 5.5966 - sparse_categorical_accuracy: 0.004213/20 [==================>...........] - ETA: 44s - loss: 5.5900 - sparse_categorical_accuracy: 0.003814/20 [====================>.........] - ETA: 38s - loss: 5.5888 - sparse_categorical_accuracy: 0.003615/20 [=====================>........] - ETA: 31s - loss: 5.5971 - sparse_categorical_accuracy: 0.003316/20 [=======================>......] - ETA: 25s - loss: 5.5789 - sparse_categorical_accuracy: 0.003117/20 [========================>.....] - ETA: 19s - loss: 5.5578 - sparse_categorical_accuracy: 0.002918/20 [==========================>...] - ETA: 12s - loss: 5.5607 - sparse_categorical_accuracy: 0.002819/20 [===========================>..] - ETA: 6s - loss: 5.5531 - sparse_categorical_accuracy: 0.0053 20/20 [==============================] - ETA: 0s - loss: 5.5440 - sparse_categorical_accuracy: 0.00502023-05-07 20:26:10.295075: W tensorflow/core/grappler/optimizers/data/auto_shard.cc:776] AUTO sharding policy will apply DATA sharding policy as it failed to apply FILE sharding policy because of the following reason: Did not find a shardable source, walked to a node which is not a dataset: name: "FlatMapDataset/_2"
op: "FlatMapDataset"
input: "TensorDataset/_1"
attr {
  key: "Targuments"
  value {
    list {
    }
  }
}
attr {
  key: "_cardinality"
  value {
    i: -2
  }
}
attr {
  key: "f"
  value {
    func {
      name: "__inference_Dataset_flat_map_flat_map_fn_173451"
    }
  }
}
attr {
  key: "metadata"
  value {
    s: "\n\021FlatMapDataset:17"
  }
}
attr {
  key: "output_shapes"
  value {
    list {
      shape {
        dim {
          size: -1
        }
        dim {
          size: -1
        }
        dim {
          size: -1
        }
      }
      shape {
        dim {
          size: -1
        }
      }
    }
  }
}
attr {
  key: "output_types"
  value {
    list {
      type: DT_FLOAT
      type: DT_INT32
    }
  }
}
experimental_type {
  type_id: TFT_PRODUCT
  args {
    type_id: TFT_DATASET
    args {
      type_id: TFT_PRODUCT
      args {
        type_id: TFT_TENSOR
        args {
          type_id: TFT_FLOAT
        }
      }
      args {
        type_id: TFT_TENSOR
        args {
          type_id: TFT_INT32
        }
      }
    }
  }
}
. Consider either turning off auto-sharding or switching the auto_shard_policy to DATA to shard this dataset. You can do this by creating a new `tf.data.Options()` object then setting `options.experimental_distribute.auto_shard_policy = AutoShardPolicy.DATA` before applying the options object to the dataset via `dataset.with_options(options)`.
20/20 [==============================] - 225s 9s/step - loss: 5.5440 - sparse_categorical_accuracy: 0.0050 - val_loss: 5.4542 - val_sparse_categorical_accuracy: 0.0100
Epoch 2/750
 1/20 [>.............................] - ETA: 2:04 - loss: 5.6248 - sparse_categorical_accuracy: 0.0000e+00 2/20 [==>...........................] - ETA: 1:54 - loss: 5.6382 - sparse_categorical_accuracy: 0.0000e+00 3/20 [===>..........................] - ETA: 1:48 - loss: 5.6043 - sparse_categorical_accuracy: 0.0000e+00 4/20 [=====>........................] - ETA: 1:41 - loss: 5.5827 - sparse_categorical_accuracy: 0.0000e+00 5/20 [======>.......................] - ETA: 1:35 - loss: 5.5700 - sparse_categorical_accuracy: 0.0000e+00 6/20 [========>.....................] - ETA: 1:29 - loss: 5.5516 - sparse_categorical_accuracy: 0.0000e+00 7/20 [=========>....................] - ETA: 1:22 - loss: 5.5357 - sparse_categorical_accuracy: 0.0071     8/20 [===========>..................] - ETA: 1:16 - loss: 5.5294 - sparse_categorical_accuracy: 0.0063 9/20 [============>.................] - ETA: 1:10 - loss: 5.5279 - sparse_categorical_accuracy: 0.005610/20 [==============>...............] - ETA: 1:03 - loss: 5.5287 - sparse_categorical_accuracy: 0.005011/20 [===============>..............] - ETA: 57s - loss: 5.5403 - sparse_categorical_accuracy: 0.0045 12/20 [=================>............] - ETA: 50s - loss: 5.5414 - sparse_categorical_accuracy: 0.004213/20 [==================>...........] - ETA: 44s - loss: 5.5493 - sparse_categorical_accuracy: 0.003814/20 [====================>.........] - ETA: 38s - loss: 5.5472 - sparse_categorical_accuracy: 0.003615/20 [=====================>........] - ETA: 31s - loss: 5.5403 - sparse_categorical_accuracy: 0.003316/20 [=======================>......] - ETA: 25s - loss: 5.5512 - sparse_categorical_accuracy: 0.003117/20 [========================>.....] - ETA: 19s - loss: 5.5458 - sparse_categorical_accuracy: 0.002918/20 [==========================>...] - ETA: 12s - loss: 5.5303 - sparse_categorical_accuracy: 0.002819/20 [===========================>..] - ETA: 6s - loss: 5.5295 - sparse_categorical_accuracy: 0.0026 20/20 [==============================] - ETA: 0s - loss: 5.5212 - sparse_categorical_accuracy: 0.002520/20 [==============================] - 158s 8s/step - loss: 5.5212 - sparse_categorical_accuracy: 0.0025 - val_loss: 5.4005 - val_sparse_categorical_accuracy: 0.0100
Epoch 3/750
 1/20 [>.............................] - ETA: 2:04 - loss: 5.3380 - sparse_categorical_accuracy: 0.0000e+00 2/20 [==>...........................] - ETA: 1:55 - loss: 5.4329 - sparse_categorical_accuracy: 0.0250     3/20 [===>..........................] - ETA: 1:48 - loss: 5.3460 - sparse_categorical_accuracy: 0.0167 4/20 [=====>........................] - ETA: 1:42 - loss: 5.3700 - sparse_categorical_accuracy: 0.0125 5/20 [======>.......................] - ETA: 1:35 - loss: 5.4025 - sparse_categorical_accuracy: 0.0100 6/20 [========>.....................] - ETA: 1:29 - loss: 5.3626 - sparse_categorical_accuracy: 0.0083 7/20 [=========>....................] - ETA: 1:23 - loss: 5.3763 - sparse_categorical_accuracy: 0.0071 8/20 [===========>..................] - ETA: 1:16 - loss: 5.3478 - sparse_categorical_accuracy: 0.0063 9/20 [============>.................] - ETA: 1:10 - loss: 5.3448 - sparse_categorical_accuracy: 0.005610/20 [==============>...............] - ETA: 1:03 - loss: 5.3331 - sparse_categorical_accuracy: 0.005011/20 [===============>..............] - ETA: 57s - loss: 5.3389 - sparse_categorical_accuracy: 0.0045 12/20 [=================>............] - ETA: 51s - loss: 5.3546 - sparse_categorical_accuracy: 0.004213/20 [==================>...........] - ETA: 44s - loss: 5.3429 - sparse_categorical_accuracy: 0.003814/20 [====================>.........] - ETA: 38s - loss: 5.3428 - sparse_categorical_accuracy: 0.003615/20 [=====================>........] - ETA: 31s - loss: 5.3181 - sparse_categorical_accuracy: 0.003316/20 [=======================>......] - ETA: 25s - loss: 5.3236 - sparse_categorical_accuracy: 0.003117/20 [========================>.....] - ETA: 19s - loss: 5.3256 - sparse_categorical_accuracy: 0.005918/20 [==========================>...] - ETA: 12s - loss: 5.3258 - sparse_categorical_accuracy: 0.005619/20 [===========================>..] - ETA: 6s - loss: 5.3141 - sparse_categorical_accuracy: 0.0053 20/20 [==============================] - ETA: 0s - loss: 5.3044 - sparse_categorical_accuracy: 0.005020/20 [==============================] - 158s 8s/step - loss: 5.3044 - sparse_categorical_accuracy: 0.0050 - val_loss: 5.1060 - val_sparse_categorical_accuracy: 0.0200
Epoch 4/750
 1/20 [>.............................] - ETA: 2:04 - loss: 5.1480 - sparse_categorical_accuracy: 0.0000e+00 2/20 [==>...........................] - ETA: 1:55 - loss: 5.1369 - sparse_categorical_accuracy: 0.0250     3/20 [===>..........................] - ETA: 1:48 - loss: 5.1013 - sparse_categorical_accuracy: 0.0167 4/20 [=====>........................] - ETA: 1:42 - loss: 5.1102 - sparse_categorical_accuracy: 0.0125 5/20 [======>.......................] - ETA: 1:35 - loss: 5.1116 - sparse_categorical_accuracy: 0.0100 6/20 [========>.....................] - ETA: 1:29 - loss: 5.1064 - sparse_categorical_accuracy: 0.0083 7/20 [=========>....................] - ETA: 1:23 - loss: 5.0995 - sparse_categorical_accuracy: 0.0071 8/20 [===========>..................] - ETA: 1:16 - loss: 5.0909 - sparse_categorical_accuracy: 0.0063 9/20 [============>.................] - ETA: 1:10 - loss: 5.0893 - sparse_categorical_accuracy: 0.005610/20 [==============>...............] - ETA: 1:03 - loss: 5.1211 - sparse_categorical_accuracy: 0.005011/20 [===============>..............] - ETA: 57s - loss: 5.1262 - sparse_categorical_accuracy: 0.0045 12/20 [=================>............] - ETA: 51s - loss: 5.1272 - sparse_categorical_accuracy: 0.008313/20 [==================>...........] - ETA: 44s - loss: 5.1115 - sparse_categorical_accuracy: 0.007714/20 [====================>.........] - ETA: 38s - loss: 5.1080 - sparse_categorical_accuracy: 0.007115/20 [=====================>........] - ETA: 31s - loss: 5.1126 - sparse_categorical_accuracy: 0.006716/20 [=======================>......] - ETA: 25s - loss: 5.1029 - sparse_categorical_accuracy: 0.006317/20 [========================>.....] - ETA: 19s - loss: 5.1044 - sparse_categorical_accuracy: 0.005918/20 [==========================>...] - ETA: 12s - loss: 5.0890 - sparse_categorical_accuracy: 0.005619/20 [===========================>..] - ETA: 6s - loss: 5.0883 - sparse_categorical_accuracy: 0.0053 20/20 [==============================] - ETA: 0s - loss: 5.0940 - sparse_categorical_accuracy: 0.0050